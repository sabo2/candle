/* 
 * CampFire.js
 * 
 * CampFire.js is a graphic library for JavaScript.
 * 
 * @author  D.Kobayashi
 * @version v0.0.0
 * @date    2010-02-26
 * 
 * This script is referencing following library.
 *  uuCanvas.js (version 1.0)
 *  http://code.google.com/p/uupaa-js-spinoff/	uupaa.js SpinOff Project Home(Google Code)
 * 
 * This script is under the MIT license. Please see below.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 */
(function(){if(!!window.Camp){return;}var _win=this,_doc=document,_ms=Math.sin,_mc=Math.cos,_2PI=2*Math.PI,_IE=!!(window.attachEvent&&!window.opera),Z=10,Z2=Z/2,_color=[],flags={debugmode:false},_types=['svg','canvas','sl','flash','vml'],VML=0,SVG=1,CANVAS=2,SL=3,FLASH=4,BEFOREEND='BeforeEnd';var _hex=(function(){var tbl=[];for(var r=256;r<512;r++){tbl[r-256]=r.toString(16).substr(1);}return tbl;})();function getRectSize(el){return{width:(el.offsetWidth||el.clientWidth),height:(el.offsetHeight||el.clientHeight)};}function parsecolor(rgbstr){if(!_color[rgbstr]){if(rgbstr.substr(0,4)==='rgb('){var m=rgbstr.match(/\d+/g);_color[rgbstr]=["#",_hex[m[0]],_hex[m[1]],_hex[m[2]]].join('');}else{_color[rgbstr]=rgbstr;}}return _color[rgbstr];}function parsecolorrev(colorstr){if(colorstr.match(/\#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/)){var m0=parseInt(RegExp.$1,16).toString();var m1=parseInt(RegExp.$2,16).toString();var m2=parseInt(RegExp.$3,16).toString();return["rgb(",m0,',',m1,',',m2,")"].join('');}return colorstr;}function _extend(obj,ads){for(var name in ads){obj[name]=ads[name];}}var TypeList=function(){this.canvas=false;this.vml=false;this.svg=false;this.sl=false;this.flash=false;};var V_TAG_SHAPE='<v:shape',V_TAG_GROUP='<v:group',V_TAG_TEXTPATH='<v:textpath',V_TAG_POLYLINE='<v:polyline',V_TAG_PATH_FOR_TEXTPATH='<v:path textpathok="t" />';V_EL_UNSELECTABLE='',V_TAGEND='>',V_TAGEND_NULL=' />',V_CLOSETAG_SHAPE='</v:shape>',V_CLOSETAG_GROUP='</v:group>',V_CLOSETAG_TEXTPATH='</v:textpath>',V_CLOSETAG_POLYLINE='</v:polyline>',V_ATT_ID=' id="',V_ATT_PATH=' path="',V_ATT_POINTS=' points="',V_ATT_STYLE=' style="',V_ATT_STRING=' string="',V_ATT_COORDSIZE=' coordsize="100,100"',V_ATT_FILLCOLOR=' fillcolor="',V_ATT_STROKECOLOR=' strokecolor="',V_ATT_STROKEWEIGHT=' strokeweight="',V_ATT_END='"',V_ATT_STYLE_TEXTBOX=' style="white-space:nowrap;cursor:default;font:10px sans-serif;"',V_DEF_ATT_POLYLINE=' stroked="f" filled="t"',V_DEF_ATT_TEXTPATH=' on="t" xscale="t"',V_STYLE_LEFT='left:',V_STYLE_TOP='top:',V_STYLE_FONT='font:',V_STYLE_ALIGN='v-text-align:',V_STYLE_END=';',V_PATH_MOVE=' m',V_PATH_LINE=' l',V_PATH_CLOSE=' x',V_PATH_NOSTROKE=' ns',V_PATH_NOFILL=' nf';var SVGNS="http://www.w3.org/2000/svg",S_PATH_MOVE=' M',S_PATH_LINE=' L',S_PATH_ARCTO=' A',S_PATH_CLOSE=' z',S_ATT_ID='id';S_ATT_FILL='fill';S_ATT_STROKE='stroke';S_ATT_STROKEWIDTH='stroke-width',S_ATT_RENDERING='shape-rendering',SVG_ANCHOR={left:'start',center:'middle',right:'end'},S_NONE='none';var EL_ID_HEADER="canvas_o_",EMPTY='';var VectorContext=function(type,idname){this.fillStyle='black';this.strokeStyle='black';this.lineWidth=1;this.font='14px system';this.textAlign='center';this.textBaseline='middle';this.OFFSETX=0;this.OFFSETY=0;this.vid='';this.elements=[];this.type=type;this.target=null;this.parent=null;this.canvas=null;this.idname=idname;this.canvasid=EL_ID_HEADER+idname;this.currentpath=[];this.lastpath='';this.isAA=false;this.content=null;this.use=new TypeList();if(this.type===SVG||this.type===SL){this.PATH_MOVE=S_PATH_MOVE;this.PATH_LINE=S_PATH_LINE;this.PATH_CLOSE=S_PATH_CLOSE;if(this.type===SVG){this.use.svg=true;}if(this.type===SL){this.use.sl=true;}}else if(this.type===VML){this.PATH_MOVE=V_PATH_MOVE;this.PATH_LINE=V_PATH_LINE;this.PATH_CLOSE=V_PATH_CLOSE;this.use.vml=true;}this.initElement(idname);};VectorContext.prototype={initElement:function(idname){var child=null;if(this.type!==SL){child=_doc.getElementById(this.canvasid)}else if(!!this.content){child=this.content.findName(this.canvasid);}if(!child){var parent=_doc.getElementById(idname);var rect=getRectSize(parent);if(this.type===SVG){this.appendSVG(parent,rect.width,rect.height);}else if(this.type===SL){this.appendSL(parent,rect.width,rect.height);}else if(this.type===VML){this.appendVML(parent,rect.width,rect.height);}child=this.canvas;var self=this;parent.style.display='block';parent.style.position='relative';parent.style.overflow='hidden';if(flags.debugmode){parent.style.backgroundColor="#efefef";parent.style.border="solid 1px silver";}parent.getContext=function(type){if(!self.canvas){self.initElement(self.idname);}return self;};parent.toDataURL=function(type){return null;};this.parent=parent;this.target=this.canvas;if(!!this.target){this.addVectorElement(true,false,false,[0,0,rect.width,rect.height]);}}this.target=child;},appendSVG:function(parent,width,height){var svgtop=_doc.createElementNS(SVGNS,'svg');svgtop.setAttribute('id',this.canvasid);svgtop.setAttribute('font-size',"10px");svgtop.setAttribute('font-family',"sans-serif");svgtop.setAttribute('width',width);svgtop.setAttribute('height',height);svgtop.setAttribute('viewBox',[0,0,width,height].join(' '));parent.appendChild(svgtop);this.canvas=svgtop;},appendVML:function(parent,width,height){var vmltop=_doc.createElement('div');vmltop.id=this.canvasid;vmltop.style.position='absolute';vmltop.style.left='-2px';vmltop.style.top='-2px';vmltop.style.width=width+'px';vmltop.style.height=height+'px';parent.appendChild(vmltop);this.canvas=vmltop;},appendSL:function(parent,width,height){parent.innerHTML=['<object type="application/x-silverlight" width="100%" height="100%" id="',this.canvasid,'_object" />','<param name="windowless" value="true" />','<param name="background" value="#00000000" />','<param name="source" value="#',this.canvasid,'_script" />','</object>','<script type="text/xaml" id="',this.canvasid,'_script">','<Canvas xmlns="http://schemas.microsoft.com/client/2007" Name="',this.canvasid,'" />','</script>'].join('');if(document.getElementById([this.canvasid,'object'].join('_')).IsLoaded){this.content=document.getElementById([this.canvasid,'object'].join('_')).content;this.canvas=this.content.findName(this.canvasid);}},setLayer:function(layerid){this.initElement(this.idname);if(!!layerid){var lid=[this.canvasid,"layer",layerid].join('_');var layer=(this.type!==SL?_doc.getElementById(lid):this.content.findName(lid));if(!layer){if(this.type===SVG){layer=_doc.createElementNS(SVGNS,'g');layer.setAttribute('id',lid);this.target.appendChild(layer);}else if(this.type===SL){layer=this.content.createFromXaml(['<Canvas Name="',lid,'"/>'].join(''));this.target.children.add(layer);}else{layer=_doc.createElement('div');layer.id=lid;layer.unselectable=(!!V_EL_UNSELECTABLE?'on':'');layer.style.position='absolute';layer.style.left='0px';layer.style.top='0px';this.target.appendChild(layer);}}this.target=layer;}},setRendering:function(render){if(this.type===SVG){this.canvas.setAttribute(S_ATT_RENDERING,render);}},setUnselectable:function(unsel){if(unsel===(void 0)){unsel=true;}else{unsel=!!unsel;}if(this.type===VML){V_EL_UNSELECTABLE=(unsel?' unselectable="on"':'');this.parent.unselectable=(unsel?'on':'');this.canvas.unselectable=(unsel?'on':'');}else if(this.type===SL){this.parent.unselectable=(unsel?'on':'');}else if(this.type===SVG){this.parent.style.MozUserSelect=(unsel?'none':'text');this.parent.style.WebkitUserSelect=(unsel?'none':'text');this.parent.style.userSelect=(unsel?'none':'text');}},getContextElement:function(){if(this.type===SL&&!this.canvas){this.initElement(this.idname);}return this.canvas;},getLayerElement:function(){return this.target;},changeSize:function(width,height){this.parent.style.width=width+'px';this.parent.style.height=height+'px';var child=this.parent.firstChild;if(this.type===SVG){child.setAttribute('width',width);child.setAttribute('height',height);child.setAttribute('viewBox',[0,0,width,height].join(' '));}else if(this.type==SL){child.height=(height+1)+'px';child.width=width+'px';child.height=height+'px';}else if(this.type==VML){child.style.width=width+'px';child.style.height=height+'px';}},changeOrigin:function(left,top){var child=this.parent.firstChild;if(this.type===SVG){var m=child.getAttribute('viewBox').split(/ /);m[0]=left,m[1]=top;child.setAttribute('viewBox',m.join(' '));}else if(this.type===VML){child.style.position='absolute';child.style.left=(-left-2)+'px';child.style.top=(-top -2)+'px';}else if(this.type===SL){this.OFFSETX=-left;this.OFFSETY=-top;}},clear:function(){if(this.type!==SL){_doc.getElementById(this.idname).innerHTML='';}this.elements=[];this.initElement(this.idname);if(this.type===SL){this.target.children.clear();}},beginPath:function(){this.currentpath=[];this.lastpath='';},closePath:function(){this.currentpath.push(this.PATH_CLOSE);this.lastpath=this.PATH_CLOSE;},moveTo:function(x,y){if(this.type===SVG){this.currentpath.push(this.PATH_MOVE,x,y);}else if(this.type===VML){this.currentpath.push(this.PATH_MOVE,(x*Z-Z2)|0,(y*Z-Z2)|0);}else if(this.type===SL){this.currentpath.push(this.PATH_MOVE,x+this.OFFSETX,y+this.OFFSETY);}this.lastpath=this.PATH_MOVE;},lineTo:function(x,y){if(this.lastpath!==this.PATH_LINE){this.currentpath.push(this.PATH_LINE);}if(this.type===SVG){this.currentpath.push(x,y);}else if(this.type===VML){this.currentpath.push((x*Z-Z2)|0,(y*Z-Z2)|0);}else if(this.type===SL){this.currentpath.push(x+this.OFFSETX,y+this.OFFSETY);}this.lastpath=this.PATH_LINE;},arc:function(cx,cy,r,startRad,endRad,antiClockWise){if(this.type===VML){cx=(cx*Z-Z2)|0,cy=(cy*Z-Z2)|0,r=(r*Z)|0;}else if(this.type===SL){cx+=this.OFFSETX,cy+=this.OFFSETY;}var sx=(cx+r*_mc(startRad))|0,sy=(cy+r*_ms(startRad))|0,ex=(cx+r*_mc(endRad))|0,ey=(cy+r*_ms(endRad))|0;if(this.type===VML){var com=(antiClockWise?'at':'wa');if(endRad-startRad>=2*Math.PI){sx+=1;}this.currentpath.push(com,(cx-r),(cy-r),(cx+r),(cy+r),sx,sy,ex,ey);this.lastpath=com;}else{if(sy==ey){sy+=0.125;}var unknownflag=(startRad>endRad)^(Math.abs(endRad-startRad)>Math.PI);var islong=((antiClockWise^unknownflag)?1:0),sweep=((islong==0^unknownflag)?1:0);this.currentpath.push(this.PATH_MOVE,sx,sy,S_PATH_ARCTO,r,r,0,islong,sweep,ex,ey);this.lastpath=S_PATH_ARCTO;this.isAA=true;}},fill:function(){this.addVectorElement(false,true,false,[]);},stroke:function(){this.addVectorElement(false,false,true,[]);},fillRect:function(x,y,w,h){this.addVectorElement(true,true,false,[x,y,w,h]);},strokeRect:function(x,y,w,h){this.addVectorElement(true,false,true,[x,y,w,h]);},shapeRect:function(x,y,w,h){this.addVectorElement(true,true,true,[x,y,w,h]);},fillText:function(text,x,y){switch(this.type){case SVG:var el=_doc.createElementNS(SVGNS,'text');if(!!this.vid){this.elements[this.vid]=el;}el.setAttribute('x',x);el.setAttribute('y',y+14*1.0);el.setAttribute(S_ATT_FILL,parsecolor(this.fillStyle));el.setAttribute('text-anchor',SVG_ANCHOR[this.textAlign.toLowerCase()]);el.style.font=this.font;el.appendChild(_doc.createTextNode(text));this.target.appendChild(el);break;case SL:var ar=['<TextBlock Canvas.Left="',(x+this.OFFSETX-60),'" Canvas.Top="',(y+this.OFFSETY-15*0.7), 'Width="',(60*2),'" TextAlignment="',this.textAlign,'"', 'FontFamily="','Sans-Serif','" FontSize="',16,'"', '" text="',text,'" />'];var xaml=this.content.createFromXaml(ar.join(''));if(!!this.vid){this.elements[this.vid]=xaml;}this.target.children.add(xaml);break;case VML:if(this.type===VML){x=(x*Z-Z2)|0,y=(y*Z-Z2)|0;}var ar=[V_TAG_GROUP,V_ATT_COORDSIZE,V_TAGEND];ar.push(V_TAG_POLYLINE,V_ATT_POINTS,[x-600,y,x+600,y].join(','),V_ATT_END,V_DEF_ATT_POLYLINE,V_ATT_FILLCOLOR,parsecolor(this.fillStyle),V_ATT_END,V_TAGEND);ar.push(V_TAG_PATH_FOR_TEXTPATH,V_TAG_TEXTPATH);if(!!this.vid){ar.push(V_ATT_ID,this.vid,V_ATT_END);}ar.push(V_DEF_ATT_TEXTPATH,V_ATT_STRING,text,V_ATT_END,V_ATT_STYLE,V_STYLE_FONT,this.font,V_STYLE_END,V_STYLE_ALIGN,this.textAlign,V_STYLE_END,V_ATT_END,V_TAGEND_NULL,V_CLOSETAG_POLYLINE,V_CLOSETAG_GROUP);this.target.insertAdjacentHTML(BEFOREEND,ar.join(''));if(!!this.vid){this.elements[this.vid]=_doc.getElementById(this.vid);}break;}},shape:function(){this.addVectorElement(false,true,true,[]);},pathRect:function(size){var x=size[0],y=size[1],w=size[2],h=size[3];if(this.type===VML){x=(x*Z-Z2)|0,y=(y*Z-Z2)|0,w=(w*Z)|0,h=(h*Z)|0;}else if(this.type===SL){x+=this.OFFSETX,y+=this.OFFSETY;}return[this.PATH_MOVE,x,y,this.PATH_LINE,(x+w),y,(x+w),(y+h),x,(y+h),this.PATH_CLOSE].join(' ');},setLinePath:function(){var _args=arguments,_len=_args.length,svg=(this.type!==VML);this.currentpath=[];for(var i=0,len=_len-((_len|1)?1:2);i<len;i+=2){if(i==0){this.currentpath.push(this.PATH_MOVE);}else if(i==2){this.currentpath.push(this.PATH_LINE);}if(this.type===SVG){this.currentpath.push(_args[i],_args[i+1]);}else if(this.type===VML){this.currentpath.push((_args[i]*Z-Z2)|0,(_args[i+1]*Z-Z2)|0);}else if(this.type===SL){this.currentpath.push(_args[i]+this.OFFSETX,_args[i+1]+this.OFFSETY);}}if(_args[_len-1]){this.currentpath.push(this.PATH_CLOSE);}},setOffsetLinePath:function(){var _args=arguments,_len=_args.length,svg=(this.type!==VML),m=[_args[0],_args[1]];this.currentpath=[];for(var i=2,len=_len-((_len|1)?1:2);i<len;i+=2){m[i]=_args[i]+m[0];m[i+1]=_args[i+1]+m[1];if(this.type===VML){m[i]=(m[i]*Z-Z2)|0,m[i+1]=(m[i+1]*Z-Z2)|0;}else if(this.type===SL){m[i]+=this.OFFSETX,m[i+1]+=this.OFFSETY;}}for(var i=2,len=_len-((_len|1)?1:2);i<len;i+=2){if(i==2){this.currentpath.push(this.PATH_MOVE);}else if(i==4){this.currentpath.push(this.PATH_LINE);}this.currentpath.push(m[i],m[i+1]);}if(_args[_len-1]){this.currentpath.push(this.PATH_CLOSE);}},setDashSize:function(size){if(this.type===SVG){this.elements[this.vid].setAttribute('stroke-dasharray',size);}else if(this.type===SL){this.elements[this.vid].StrokeDashArray=size;}else if(this.type===VML){var el=_doc.createElement('v:stroke');if(size<=2){el.dashstyle='ShortDash';}else if(size<=5){el.dashstyle='Dash';}else{el.dashstyle='LongDash';}this.elements[this.vid].appendChild(el);}},strokeLine:function(x1,y1,x2,y2){if(this.type===VML){x1=x1*Z,y1=y1*Z,x2=x2*Z,y2=y2*Z;}else if(this.type===SL){x1+=this.OFFSETX,y1+=this.OFFSETY,x2+=this.OFFSETX,y2+=this.OFFSETY;}var stack=this.currentpath;this.currentpath=[this.PATH_MOVE,x1,y1,this.PATH_LINE,x2,y2];this.addVectorElement(false,false,true,[]);this.currentpath=stack;},strokeCross:function(cx,cy,l){if(this.type===VML){cx=(cx*Z-Z2)|0,cy=(cy*Z-Z2)|0,l=(l*Z)|0;}else if(this.type===SL){cx+=this.OFFSETX,cy+=this.OFFSETY;}var stack=this.currentpath;this.currentpath=[];this.currentpath.push(this.PATH_MOVE,(cx-l),(cy-l),this.PATH_LINE,(cx+l),(cy+l));this.currentpath.push(this.PATH_MOVE,(cx-l),(cy+l),this.PATH_LINE,(cx+l),(cy-l));this.addVectorElement(false,false,true,[]);this.currentpath=stack;},fillCircle:function(cx,cy,r){var stack=this.currentpath;this.currentpath=[];this.arc(cx,cy,r,0,_2PI,false);this.currentpath.push(this.PATH_CLOSE);this.addVectorElement(false,true,false,[]);this.currentpath=stack;},strokeCircle:function(cx,cy,r){var stack=this.currentpath;this.currentpath=[];this.arc(cx,cy,r,0,_2PI,false);this.currentpath.push(this.PATH_CLOSE);this.addVectorElement(false,false,true,[]);this.currentpath=stack;},shapeCircle:function(cx,cy,r){var stack=this.currentpath;this.currentpath=[];this.arc(cx,cy,r,0,_2PI,false);this.currentpath.push(this.PATH_CLOSE);this.addVectorElement(false,true,true,[]);this.currentpath=stack;},addVectorElement:function(isrect,isfill,isstroke,size){var path=(isrect?this.pathRect(size):this.currentpath.join(' '));switch(this.type){case SVG:var el=_doc.createElementNS(SVGNS,'path');if(!!this.vid){this.elements[this.vid]=el;}el.setAttribute('d',path);el.setAttribute(S_ATT_FILL,(isfill?parsecolor(this.fillStyle):S_NONE));el.setAttribute(S_ATT_STROKE,(isstroke?parsecolor(this.strokeStyle):S_NONE));if(isstroke){el.setAttribute(S_ATT_STROKEWIDTH,this.lineWidth,'px');}if(this.isAA){el.setAttribute(S_ATT_RENDERING,'auto');this.isAA=false;}this.target.appendChild(el);break;case SL:var ar=['<Path Data="',path,'"'];if(isfill){ar.push(' Fill="',parsecolor(this.fillStyle),'"');}if(isstroke){ar.push(' Stroke="',parsecolor(this.strokeStyle),'" StrokeThickness="',this.lineWidth,'"');}ar.push(' />');var xaml=this.content.createFromXaml(ar.join(''));if(!!this.vid){this.elements[this.vid]=xaml;}this.target.children.add(xaml);break;case VML:path=[path,(!isfill?V_PATH_NOFILL:EMPTY),(!isstroke?V_PATH_NOSTROKE:EMPTY)].join('');var ar=[V_TAG_SHAPE,V_EL_UNSELECTABLE];if(!!this.vid){ar=[V_TAG_SHAPE,V_EL_UNSELECTABLE,V_ATT_ID,this.vid,V_ATT_END];}ar.push(V_ATT_COORDSIZE,V_ATT_PATH,path,V_ATT_END);if(isfill){ar.push(V_ATT_FILLCOLOR,parsecolor(this.fillStyle),V_ATT_END);}if(isstroke){ar.push(V_ATT_STROKECOLOR,parsecolor(this.strokeStyle),V_ATT_END,V_ATT_STROKEWEIGHT,this.lineWidth,'px',V_ATT_END);}ar.push(V_TAGEND_NULL);this.target.insertAdjacentHTML(BEFOREEND,ar.join(''));if(!!this.vid){this.elements[this.vid]=_doc.getElementById(this.vid);}break;}}};CanvasRenderingContext2D_wrapper=function(type,idname){this.fillStyle='black';this.strokeStyle='black';this.lineWidth=1;this.font='14px system';this.textAlign='center';this.textBaseline='middle';this.OFFSETX=0;this.OFFSETY=0;this.canvasid='';this.parent=null;this.canvas=null;this.context=null;this.use=new TypeList();this.use.vml=(type===VML);this.use.svg=false;this.use.canvas=(type===CANVAS);this.use.sl=(type===SL);this.use.flash=(type===FLASH);this.initElement(idname);};CanvasRenderingContext2D_wrapper.prototype={initElement:function(idname){this.canvasid=EL_ID_HEADER+idname;var parent=_doc.getElementById(idname);var canvas=_doc.getElementById(this.canvasid);if(!canvas){canvas=_doc.createElement('canvas');canvas.id=this.canvasid;parent.appendChild(canvas);}var rect=getRectSize(parent);canvas.width=rect.width;canvas.height=rect.height;canvas.style.position='relative';canvas.style.width=rect.width+'px';canvas.style.height=rect.height+'px';this.canvas=canvas;var self=this;parent.style.display='block';parent.style.position='relative';parent.style.overflow='hidden';if(flags.debugmode){parent.style.backgroundColor="#efefef";parent.style.border="solid 1px silver";}parent.getContext=function(type){self.context=canvas.getContext(type);return self;};parent.toDataURL=function(type){return(!!type?canvas.toDataURL(type):canvas.toDataURL());};this.parent=parent;},setLayer:function(layerid){},setRendering:function(render){},setUnselectable:function(unsel){if(unsel===(void 0)){unsel=true;}else{unsel=!!unsel;}this.parent.style.MozUserSelect=(unsel?'none':'text');this.parent.style.WebkitUserSelect=(unsel?'none':'text');this.parent.style.userSelect=(unsel?'none':'text');},getContextElement:function(){return this.canvas;},getLayerElement:function(){return this.canvas;},changeSize:function(width,height){this.parent.style.width=width+'px';this.parent.style.height=height+'px';var canvas=this.parent.firstChild;var left=parseInt(canvas.style.left),top=parseInt(canvas.style.top);width+=(left<0?-left:0);height+=(top<0?-top:0);canvas.style.width=width+'px';canvas.style.height=height+'px';canvas.width=width;canvas.height=height;},changeOrigin:function(left,top){this.OFFSETX=-left;this.OFFSETY=-top;},clear:function(){if(!!this.parent.style.backgroundColor){this.setProperties();this.context.fillStyle=parsecolorrev(this.parent.style.backgroundColor);var rect=getRectSize(this.parent);this.context.fillRect(this.OFFSETX,this.OFFSETY,rect.width,rect.height);}},setProperties:function(){this.context.fillStyle=this.fillStyle;this.context.strokeStyle=this.strokeStyle;this.context.lineWidth=this.lineWidth;this.context.font=this.font;this.context.textAlign=this.textAlign;this.context.textBaseline=this.textBaseline;},beginPath:function(){this.context.beginPath();},closePath:function(){this.context.closePath();},moveTo:function(x,y){this.context.moveTo(x+this.OFFSETX,y+this.OFFSETY);},lineTo:function(x,y){this.context.lineTo(x+this.OFFSETX,y+this.OFFSETY);},arc:function(cx,cy,r,startRad,endRad,antiClockWise){this.context.arc(cx+this.OFFSETX,cy+this.OFFSETY,r,startRad,endRad,antiClockWise);},fill:function(){this.setProperties();this.context.fill();},stroke:function(){this.setProperties();this.context.stroke();},fillRect:function(x,y,w,h){this.setProperties();this.context.fillRect(x+this.OFFSETX,y+this.OFFSETY,w,h);},strokeRect:function(x,y,w,h){this.setProperties();this.context.strokeRect(x+this.OFFSETX,y+this.OFFSETY,w,h);},fillText:function(text,x,y){this.setProperties();this.context.fillText(text,x+this.OFFSETX,y+this.OFFSETY);},shape:function(){this.setProperties();this.context.fill();this.context.stroke();},shapeRect:function(x,y,w,h){this.setProperties();this.context.fillRect(x+this.OFFSETX,y+this.OFFSETY,w,h);this.context.strokeRect(x+this.OFFSETX,y+this.OFFSETY,w,h);},setLinePath:function(){var _args=arguments,_len=_args.length;for(var i=0,len=_len-((_len|1)?1:2);i<len;i+=2){if(i==0){this.context.moveTo(_args[i],_args[i+1]);}else{this.context.lineTo(_args[i],_args[i+1]);}}if(_args[_len-1]){this.context.closePath();}},setOffsetLinePath:function(){var _args=arguments,_len=_args.length,m=[];for(var i=2,len=_len-((_len|1)?1:2);i<len;i+=2){m[i]=_args[i]+m[0];m[i+1]=_args[i+1]+m[1];}for(var i=0,len=_len-((_len|1)?1:2);i<len;i+=2){if(i==0){this.context.moveTo(_args[i],_args[i+1]);}else{this.context.lineTo(_args[i],_args[i+1]);}}if(_args[_len-1]){this.context.closePath();}},setDashSize:function(size){},strokeLine:function(x1,y1,x2,y2){this.setProperties();this.context.beginPath();this.context.moveTo(x1+this.OFFSETX,y1+this.OFFSETY);this.context.lineTo(x2+this.OFFSETX,y2+this.OFFSETY);this.context.stroke();},strokeCross:function(cx,cy,l){this.setProperties();this.context.beginPath();this.context.moveTo(cx-l+this.OFFSETX,cy-l+this.OFFSETY);this.context.lineTo(cx+l+this.OFFSETX,cy+l+this.OFFSETY);this.context.moveTo(cx-l+this.OFFSETX,cy+l+this.OFFSETY);this.context.lineTo(cx+l+this.OFFSETX,cy-l+this.OFFSETY);this.context.stroke();},fillCircle:function(cx,cy,r){this.setProperties();this.context.beginPath();this.context.arc(cx+this.OFFSETX,cy+this.OFFSETY,r,0,_2PI,false);this.context.fill();},strokeCircle:function(cx,cy,r){this.setProperties();this.context.beginPath();this.context.arc(cx+this.OFFSETX,cy+this.OFFSETY,r,0,_2PI,false);this.context.stroke();},shapeCircle:function(cx,cy,r){this.setProperties();this.context.beginPath();this.context.arc(cx+this.OFFSETX,cy+this.OFFSETY,r,0,_2PI,false);this.context.fill();this.context.stroke();}};var Camp=function(idname,type){Camp.initElementById.apply(Camp,[idname,type]);};_extend(Camp,{color:_color,parse:parsecolor,enable:new TypeList(),current:new TypeList(),initAllElements:function(){this.initElementsByClassName('canvas');},initElementsByClassName:function(classname,type){var elements=_doc.getElementsByTagName('div');for(var i=0;i<elements.length;i++){if(elements[i].className.match(classname)){this.initElementById(elements[i].id,type);}}},initElementsById:function(idlist,type){for(var i=0;i<idlist.length;i++){this.initElementById(idlist[i],type);}},initElementById:function(idname,type){if(!!_doc.getElementById(EL_ID_HEADER+idname)){return;}var choice=new TypeList();if((type===void 0)||(this.enable[type]!==true)){choice=this.current;}else{choice[type]=true;}if(choice.svg){new VectorContext(SVG,idname);}else if(choice.sl){new VectorContext(SL,idname);}else if(choice.vml){new VectorContext(VML,idname);}else if(choice.canvas){new CanvasRenderingContext2D_wrapper(CANVAS,idname);}},select:function(type){if(this.enable[type]!==true){return false;}for(var i=0;i<_types.length;i++){this.current[_types[i]]=false;}this.current[type]=true;return true;}});Camp.enable.canvas=(!!_doc.createElement('canvas').getContext);Camp.enable.svg=(!!_doc.createElementNS&&!!_doc.createElementNS(SVGNS,'svg').suspendRedraw);Camp.enable.sl=(function(){try{return(new ActiveXObject("AgControl.AgControl")).IsVersionSupported("1.0");}catch(e){}return false;})();Camp.enable.flash=false;Camp.enable.vml=_IE;for(var i=0;i<_types.length;i++){Camp.current[_types[i]]=false;}if(Camp.enable.svg){Camp.current.svg=true;}else if(Camp.enable.canvas){Camp.current.canvas=true;}else if(Camp.enable.sl){Camp.current.sl=true;}else if(Camp.enable.flash){Camp.current.flash=true;}else if(Camp.enable.vml){Camp.current.vml=true;}if(Camp.enable.vml){_doc.namespaces.add("v","urn:schemas-microsoft-com:vml");var text=[];text.push("v\\:shape,v\\:group,v\\:polyline{behavior:url(#default#VML);position:absolute;width:10px;height:10px;}");text.push("v\\:path,v\\:textpath,v\\:stroke{behavior:url(#default#VML);}");_doc.createStyleSheet().cssText=text.join('');}_win.Camp=Camp;})();(function(){if(!window.Camp){return;}if(!!window.Camp.Fire){return;}var _win=this,_doc=document,_mf=Math.floor,_ms=Math.sin,_mc=Math.cos,_2PI=2*Math.PI,Camp=_win.Camp,textContent={};function _extend(obj,ads){for(var name in ads){obj[name]=ads[name];}}Camp.Fire=function(idname){Camp.Fire.dance(idname);};_extend(Camp.Fire,{JSON:{},dance:function(idname,type){if(typeof idname==='string'){this.generate(idname,type);}else if((typeof idname==='object')&&(idname instanceof Array)){for(var i=0;i<idname.length;i++){this.generate(idname[i],type);}}},generate:function(idname,type){var el=document.getElementById(idname);if(!el){return;}var text=textContent[idname];if(!text){text=(!!el.textContent?el.textContent:el.innerText);textContent[idname]=text;}el.innerHTML='';var json={};try{json=JSON.parse(text);}catch(e){json=eval("("+text+")");}if(!json.data){json.data={};}if(!!json['data-templete']){var el2=document.getElementById(json['data-templete']);if(!!el2){var text2=(!!el2.textContent?el2.textContent:el2.innerText);var json2={};try{json2=JSON.parse(text2);}catch(e){json2=eval("("+text2+")");}json.data=json2;}}for(var origkey in json){if(origkey.match(/data\-(\w+)/)&&RegExp.$1!=='templete'){var key=RegExp.$1;for(var i=0;i<json.data.length;i++){if(json[origkey][i]!=null){json.data[i][key]=json[origkey][i];}}}}for(var i=0;i<json.data.length;i++){if(!json.data[i].value){json.data[i].display='none';}}if(!!type){json.main.type=type;}this.JSON[idname]=json;this.redraw(idname);},redraw:function(idname){var json=this.JSON[idname];if(!json.data){return;}switch(json.main.type.toLowerCase()){case 'point':drawPointGraph(idname,json,false);break;case 'pointratio':drawPointGraph(idname,json,true);break;case 'line':drawLineGraph(idname,json,false);break;case 'lineratio':drawLineGraph(idname,json,true);break;case 'bar':drawBarGraph(idname,json,false);break;case 'barstack':drawBarGraph(idname,json,false);break;case 'barstackratio':drawBarGraph(idname,json,true);break;case 'area':drawAreaGraph(idname,json,false);break;case 'arearatio':drawAreaGraph(idname,json,true);break;case 'dot':case 'dotchart':drawDotChart(idname,json);break;}}});function normalizeData(json,stack,ratio){var space=json.graph['top-space'];if(json.main.type.toLowerCase()==='arearatio'){space=0;}else if(json.graph['top-space']===void 0){space=0.06;}var total=[],max=0;if(!stack&&!ratio){for(var t=0;t<json.xlabel.length;t++){for(var i=0;i<json.data.length;i++){if(json.data[i].display==='none'){continue;}var val=json.data[i].value[t];if(val>max){max=val;}}}}else{for(var t=0;t<json.xlabel.length;t++){total[t]=0;for(var i=0;i<json.data.length;i++){if(json.data[i].display==='none'){continue;}var val=json.data[i].value[t];total[t]+=(!isNaN(val)?val:0);if(!stack&&val>max){max=val;}}if(stack&&total[t]>max){max=total[t];}}}var normalize=[];if(!stack&&ratio){var max_ratio=0.01,max_total=0;for(var t=0;t<json.xlabel.length;t++){for(var i=0;i<json.data.length;i++){if(json.data[i].display==='none'){continue;}var val=json.data[i].value[t];val=(!isNaN(val)?val:0);if(val/total[t]>max_ratio){max_ratio=val/total[t];};}}for(var t=0;t<json.xlabel.length;t++){normalize[t]=total[t]*max_ratio*(1+space);}}else if(!ratio){max=_mf(max*(1+space));for(var t=0;t<json.xlabel.length;t++){normalize[t]=max;}}else{for(var t=0;t<json.xlabel.length;t++){normalize[t]=total[t];}}return normalize;}function settingCanvas(idname,json){Camp(idname);var ctx=document.getElementById(idname).getContext("2d");ctx.changeSize(json.main.size[0],json.main.size[1]);ctx.clear();ctx.changeOrigin(0,0);ctx.lineWidth='1';ctx.setLayer('graph');var size=[json.graph.origin[0],json.graph.origin[1],json.graph.size[0],json.graph.size[1]];if(!json.graph.bgcolor){ctx.strokeRect.apply(ctx,size);}else{ctx.fillStyle=json.graph.bgcolor;ctx.addVectorElement(true,true,true,size);}return ctx;}function drawPointGraph(idname,json,ratio){json.graph.line='none';drawLineGraph(idname,json,ratio);}function drawLineGraph(idname,json,ratio){var WIDTH=json.graph.size[0],HEIGHT=json.graph.size[1],LEFT=json.graph.origin[0],TOP=json.graph.origin[1],xlabel=json.xlabel,ctx=settingCanvas(idname,json),normalize=normalizeData(json,false,ratio);var mkpos=[],mwidth=WIDTH/xlabel.length,moffset=mwidth/2;for(var t=0;t<xlabel.length;t++){mkpos[t]=[(LEFT+t*mwidth+moffset)|0];}for(var i=0;i<json.data.length;i++){var info=json.data[i],vals=info.value;if(!vals||vals.length===0||info.display==='none'){continue;}for(var t=0;t<xlabel.length;t++){if(!vals[t]){vals[t]=0;}if(normalize[t]>0){mkpos[t][1]=TOP+_mf(HEIGHT*(1-vals[t]/normalize[t]));}else{mkpos[t][1]=(t>0?ypos[t-1]:TOP+HEIGHT);}}var color=(!!info.color?info.color:'');ctx.fillStyle=(!!color?color:'black');ctx.strokeStyle=(!!color?color:'none');if((!info.line||info.line!=='none')&&(!json.graph.line||!json.graph.line==='none')){ctx.lineWidth='2';ctx.beginPath();ctx.moveTo(mkpos[0][0],mkpos[0][1]);for(var t=1;t<xlabel.length;t++){ctx.lineTo(mkpos[t][0],mkpos[t][1]);}ctx.stroke();}drawMarker(((info.marker!==void 0)?info.marker:json.graph.marker),ctx,mkpos);}}function drawMarker(markerInfo,ctx,mkpos){if(!markerInfo){return;}var marker=markerInfo.split(/[]+/g).join('').split(/,/);var markerType=marker[0];var markerSize=(!!marker[1]?parseInt(marker[1]):4);ctx.lineWidth=(!!marker[2]?parseInt(marker[2]):1);if(markerType==='none'){return;}for(var t=0;t<mkpos.length;t++){var px=mkpos[t][0],py=mkpos[t][1];switch(markerType){case 'cross':ctx.strokeCross(px,py,markerSize);break;case 'plus':ctx.beginPath();ctx.moveTo(px-markerSize,py);ctx.lineTo(px+markerSize,py);ctx.moveTo(px,py-markerSize);ctx.lineTo(px,py+markerSize);ctx.stroke();break;case 'triangle':case 'triangle-stroke':ctx.beginPath();ctx.moveTo(px+markerSize*_ms(0/3*Math.PI),py-markerSize*_mc(0/3*Math.PI));ctx.lineTo(px+markerSize*_ms(2/3*Math.PI),py-markerSize*_mc(2/3*Math.PI));ctx.lineTo(px+markerSize*_ms(4/3*Math.PI),py-markerSize*_mc(4/3*Math.PI));ctx.closePath();if(markerType==='triangle'){ctx.fill();}else{ctx.stroke();}break;case 'invtriangle':case 'invtriangle-stroke':ctx.beginPath();ctx.moveTo(px+markerSize*_ms(0/3*Math.PI),py+markerSize*_mc(0/3*Math.PI));ctx.lineTo(px+markerSize*_ms(2/3*Math.PI),py+markerSize*_mc(2/3*Math.PI));ctx.lineTo(px+markerSize*_ms(4/3*Math.PI),py+markerSize*_mc(4/3*Math.PI));ctx.closePath();if(markerType==='invtriangle'){ctx.fill();}else{ctx.stroke();}break;case 'star':case 'star-stroke':ctx.beginPath();ctx.moveTo(px,py-markerSize);for(var i=1;i<10;i++){var size=(!(i&1)?markerSize:markerSize/2.2);ctx.lineTo(px+size*_ms((i/10)*_2PI),py-size*_mc((i/10)*_2PI));}ctx.closePath();if(markerType==='star'){ctx.fill();}else{ctx.stroke();}break;case 'diamond':case 'diamond-stroke':ctx.setOffsetLinePath(px,py,0,-markerSize,markerSize,0,0,markerSize,-markerSize,0,true);if(markerType==='diamond'){ctx.fill();}else{ctx.stroke();}break;case 'square':ctx.fillRect(px-markerSize,py-markerSize,2*markerSize,2*markerSize);break;case 'square-stroke':ctx.strokeRect(px-markerSize,py-markerSize,2*markerSize,2*markerSize);break;case 'oval-stroke':ctx.strokeCircle(px,py,markerSize);break;case 'oval':default:ctx.fillCircle(px,py,markerSize);break;}}}function drawBarGraph(idname,json,ratio){var WIDTH=json.graph.size[0],HEIGHT=json.graph.size[1],LEFT=json.graph.origin[0],TOP=json.graph.origin[1],xlabel=json.xlabel,ctx=settingCanvas(idname,json),normalize=normalizeData(json,(json.main.type.toLowerCase()!=='bar'),ratio);var currentBase=[],xpos=[],mwidth=WIDTH/xlabel.length,moffset=mwidth/2;for(var t=0;t<xlabel.length;t++){currentBase[t]=0;xpos[t]=_mf(LEFT+t*mwidth+moffset);}var bwidth=mwidth*0.7/2;var type=json.main.type.toLowerCase();for(var i=0;i<json.data.length;i++){var info=json.data[i],vals=info.value,ypos=[],ypos_b=[];if(!vals||vals.length===0||info.display==='none'){continue;}if(type==='bar'){for(var t=0;t<xlabel.length;t++){if(!vals[t]){vals[t]=0;}ypos_b[t]=TOP+HEIGHT;if(normalize[t]>0){ypos[t]=TOP+_mf(HEIGHT*(1-(currentBase[t]+vals[t])/normalize[t]));}else{ypos[t]=(t>0?ypos[t-1]:TOP+HEIGHT);}}}else{for(var t=0;t<xlabel.length;t++){if(!vals[t]){vals[t]=0;}if(normalize[t]>0){ypos_b[t]=TOP+_mf(HEIGHT*(1- currentBase[t]/normalize[t]));ypos[t]=TOP+_mf(HEIGHT*(1-(currentBase[t]+vals[t])/normalize[t]));}else{ypos_b[t]=(t>0?ypos_b[t-1]:TOP+HEIGHT);ypos[t]=(t>0?ypos[t-1]:TOP+HEIGHT);}currentBase[t]+=vals[t];}}var color=(!!info.color?info.color:'');ctx.fillStyle=(!!color?color:'none');ctx.lineWidth='1';ctx.strokeStyle='black';for(var t=0;t<xlabel.length;t++){var x1=_mf(xpos[t]-bwidth),y1=_mf(ypos[t]),x2=_mf(xpos[t]+bwidth),y2=_mf(ypos_b[t]);ctx.setLinePath(x1,y1,x2,y1,x2,y2,x1,y2,true);ctx.shape();}}}function drawAreaGraph(idname,json,ratio){var WIDTH=json.graph.size[0],HEIGHT=json.graph.size[1],LEFT=json.graph.origin[0],TOP=json.graph.origin[1],xlabel=json.xlabel,ctx=settingCanvas(idname,json),normalize=normalizeData(json,true,ratio);var currentBase=[],xpos=[],mwidth=WIDTH/(xlabel.length-1);for(var t=0;t<xlabel.length;t++){currentBase[t]=0;xpos[t]=_mf(LEFT+t*mwidth);}for(var i=0;i<json.data.length;i++){var info=json.data[i],vals=info.value,ypos_b=[],ypos=[];if(!vals||vals.length===0||info.display==='none'){continue;}for(var t=0;t<xlabel.length;t++){if(!vals[t]){vals[t]=0;}if(normalize[t]>0){ypos_b[t]=TOP+_mf(HEIGHT*(1- currentBase[t]/normalize[t]));ypos[t]=TOP+_mf(HEIGHT*(1-(currentBase[t]+vals[t])/normalize[t]));}else{ypos_b[t]=(t>0?ypos_b[t-1]:TOP+HEIGHT);ypos[t]=(t>0?ypos[t-1]:TOP+HEIGHT);}currentBase[t]+=vals[t];}var color=(!!info.color?info.color:'');ctx.strokeStyle="black";ctx.fillStyle=(!!color?color:'none');ctx.beginPath();ctx.moveTo(xpos[0],ypos_b[0]);for(var t=1;t<xlabel.length;t++){ctx.lineTo(xpos[t],ypos_b[t]);}for(var t=xlabel.length-1;t>=1;t--){ctx.lineTo(xpos[t],ypos[t]);}ctx.lineTo(xpos[0],ypos[0]);ctx.closePath();ctx.shape();}}function drawDotChart(idname,json){var WIDTH=json.graph.size[0],HEIGHT=json.graph.size[1],LEFT=json.graph.origin[0],TOP=json.graph.origin[1],xlabel=json.xlabel,ctx=settingCanvas(idname,json);var xpos=[],mwidth=WIDTH/xlabel.length,moffset=mwidth/2;for(var t=0;t<xlabel.length;t++){xpos[t]=_mf(LEFT+t*mwidth+moffset);}var max_rsize=Math.min(mwidth,HEIGHT/json.data.length)*0.66;var max_val=0;for(var i=0;i<json.data.length;i++){for(var t=0;t<xlabel.length;t++){var val=Math.pow(json.data[i].value[t],0.5);if(val>max_val){max_val=val;}}}for(var i=0;i<json.data.length;i++){var info=json.data[i],vals=info.value,rsize=[];if(!vals||vals.length===0||info.display==='none'){continue;}var ypos=_mf(TOP+HEIGHT*((i+0.5)/json.data.length));for(var t=0;t<xlabel.length;t++){if(!vals[t]){vals[t]=0;}rsize[t]=max_rsize*(Math.pow(vals[t],0.5)/max_val);}var color=(!!info.color?info.color:'');ctx.fillStyle=(!!color?color:'none');ctx.strokeStyle="black";ctx.lineWidth=1;if(ctx.fillStyle!=='none'&&ctx.fillStyle!=='white'&&Camp.parse(ctx.fillStyle)!=='#ffffff'){for(var t=0;t<xlabel.length;t++){ctx.fillCircle(xpos[t],ypos,rsize[t]);}}else{for(var t=0;t<xlabel.length;t++){ctx.strokeCircle(xpos[t],ypos,rsize[t]);}}}}})();